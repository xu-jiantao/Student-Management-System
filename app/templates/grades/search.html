{% extends "base.html" %}
{% block title %}成绩查询{% endblock %}
{% block content %}
  <div class="page-header">
    <div>
      <div class="page-title">成绩查询</div>
      <div class="page-subtitle">按班级、课程或关键字搜索历史成绩记录。</div>
    </div>
  </div>

  <form class="filter-panel" method="get">
    <div class="filter-grid">
      <div class="filter-field">
        <label class="form-label" for="class_id">班级</label>
        <select class="form-select" id="class_id" name="class_id">
          <option value="">全部班级</option>
          {% for classroom in classes %}
            <option value="{{ classroom.id }}" {% if selected_class_id == classroom.id %}selected{% endif %}>{{ classroom.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="filter-field">
        <label class="form-label" for="course_id">课程</label>
        <select class="form-select" id="course_id" name="course_id">
          <option value="">全部课程</option>
          {% for course in courses %}
            <option value="{{ course.id }}" {% if selected_course_id == course.id %}selected{% endif %}>{{ course.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="filter-field">
        <label class="form-label" for="term">学期</label>
        <input type="text" class="form-control" id="term" name="term" value="{{ term }}" placeholder="如 2023-2024 上学期">
      </div>
      <div class="filter-field">
        <label class="form-label" for="q">关键字</label>
        <input type="text" class="form-control" id="q" name="q" value="{{ keyword }}" placeholder="学生姓名/学号/课程">
      </div>
    </div>
    <div class="filter-actions">
      <button type="submit" class="btn btn-primary">搜索</button>
      <a class="btn btn-link" href="{{ url_for('grades.search') }}">重置</a>
    </div>
  </form>

  <section class="card">
    <div class="table-responsive">
      <table class="table table-striped mb-0">
        <thead class="table-light">
          <tr><th>学号</th><th>姓名</th><th>课程</th><th>学期</th><th>类型</th><th>成绩</th><th>时间</th></tr>
        </thead>
        <tbody>
          {% for record in results %}
            <tr>
              <td>{{ record.student.student_number }}</td>
              <td>{{ record.student.name }}</td>
              <td>{{ record.course.name }}</td>
              <td>{{ record.term }}</td>
              <td>{{ record.assessment_type }}</td>
              <td>{{ record.score }}</td>
              <td>{{ record.recorded_at.strftime('%Y-%m-%d %H:%M') }}</td>
            </tr>
          {% else %}
            <tr><td colspan="7" class="text-center text-muted py-4">暂无成绩记录</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
{% endblock %}

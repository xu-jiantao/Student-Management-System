{% extends "base.html" %}
{% block title %}用户权限管理{% endblock %}
{% block content %}
  <div class="page-header">
    <div>
      <div class="page-title">用户权限管理</div>
      <div class="page-subtitle">为系统用户分配角色，控制各模块的访问权。</div>
    </div>
  </div>

  <div class="user-grid">
    {% for user in users %}
      <section class="card user-card">
        <div class="card-header user-card__header">
          <div>
            <div class="user-card__name">{{ user.username }}</div>
            <div class="user-card__email">{{ user.email }}</div>
          </div>
          <span class="badge">{{ user.roles|length }} 角色</span>
        </div>
        <div class="card-body user-card__body">
          <form method="post" class="user-form">
            <input type="hidden" name="user_id" value="{{ user.id }}">
            <div class="user-form__roles">
              {% for role in roles %}
                {% set checkbox_id = 'user-' ~ user.id ~ '-role-' ~ role.id %}
                <label class="role-chip" for="{{ checkbox_id }}">
                  <input id="{{ checkbox_id }}" type="checkbox" name="role_ids" value="{{ role.id }}" {% if role in user.roles %}checked{% endif %}>
                  <span>{{ role.name }}</span>
                </label>
              {% endfor %}
            </div>
            <div class="user-form__actions">
              <button type="submit" class="btn btn-primary btn-sm">保存角色</button>
            </div>
          </form>
        </div>
      </section>
    {% else %}
      <div class="empty-state">暂无用户信息。</div>
    {% endfor %}
  </div>
{% endblock %}

{% extends "base.html" %}
{% block title %}学生管理{% endblock %}
{% block content %}
  <div class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <h1 class="h4 mb-0">学生管理</h1>
      <small class="text-muted">支持搜索、筛选、导入导出和分页浏览</small>
    </div>
    <div class="btn-group">
      <a class="btn btn-primary" href="{{ url_for('students.create_student') }}">新增学生</a>
      <a class="btn btn-outline-primary" href="{{ url_for('students.import_students') }}">批量导入</a>
      <a class="btn btn-outline-secondary" href="{{ url_for('students.export_students') }}">导出Excel</a>
    </div>
  </div>

  <form class="row g-2 align-items-end mb-3" method="get">
    <div class="col-md-3">
      <label class="form-label" for="q">关键字</label>
      <input type="text" class="form-control" id="q" name="q" placeholder="姓名/学号/邮箱" value="{{ keyword }}">
    </div>
    <div class="col-md-3">
      <label class="form-label" for="class_id">班级</label>
      <select class="form-select" id="class_id" name="class_id">
        <option value="">全部</option>
        {% for classroom in classes %}
          <option value="{{ classroom.id }}" {% if class_id == classroom.id %}selected{% endif %}>{{ classroom.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2">
      <label class="form-label" for="gender">性别</label>
      <select class="form-select" id="gender" name="gender">
        <option value="">全部</option>
        <option value="男" {% if gender == '男' %}selected{% endif %}>男</option>
        <option value="女" {% if gender == '女' %}selected{% endif %}>女</option>
      </select>
    </div>
    <div class="col-md-2">
      <label class="form-label">每页数量</label>
      <input class="form-control" type="number" value="{{ per_page }}" disabled>
    </div>
    <div class="col-md-2">
      <button type="submit" class="btn btn-outline-primary w-100">搜索</button>
    </div>
  </form>

  <div class="card shadow-sm">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>学号</th>
            <th>姓名</th>
            <th>性别</th>
            <th>班级</th>
            <th>邮箱</th>
            <th>联系电话</th>
            <th class="text-end">操作</th>
          </tr>
        </thead>
        <tbody>
          {% for student in students %}
            <tr>
              <td>{{ student.student_number }}</td>
              <td><a href="{{ url_for('students.student_detail', student_id=student.id) }}">{{ student.name }}</a></td>
              <td>{{ student.gender }}</td>
              <td>{{ student.classroom.name if student.classroom else '-' }}</td>
              <td>{{ student.email }}</td>
              <td>{{ student.phone }}</td>
              <td class="text-end">
                <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('students.edit_student', student_id=student.id) }}">编辑</a>
                <form class="d-inline" method="post" action="{{ url_for('students.delete_student', student_id=student.id) }}" onsubmit="return confirm('确认删除该学生信息？');">
                  <button type="submit" class="btn btn-sm btn-outline-danger">删除</button>
                </form>
              </td>
            </tr>
          {% else %}
            <tr><td colspan="7" class="text-center text-muted py-4">没有查到匹配的学生</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% set total_pages = (total // per_page) + (1 if total % per_page else 0) %}
  {% if total_pages > 1 %}
    <nav class="mt-3">
      <ul class="pagination">
        {% for p in range(1, total_pages + 1) %}
          <li class="page-item {% if p == page %}active{% endif %}"><a class="page-link" href="{{ url_for('students.list_students', page=p, q=keyword, class_id=class_id, gender=gender) }}">{{ p }}</a></li>
        {% endfor %}
      </ul>
    </nav>
  {% endif %}
{% endblock %}
